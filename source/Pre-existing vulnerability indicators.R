# horizontal aggregation
## Pre-existing vulnerability indicators
r <-
# response <-
  response %>%
  # Vulnerable heads of household
  new_recoding(target = hhh) %>%
  recode_to(to = "Adult Female-headed", 
            where = breadwinner == "adult_female" & household_expenditure.adult_female == 1) %>%
  recode_to(to = "Male Elderly-headed",
            where = breadwinner == "eldery_male" & household_expenditure.eldery_male == 1) %>%
  recode_to(to = "Female Elderly-headed",
            where = breadwinner == "eldery_female" & household_expenditure.eldery_female == 1) %>%
  recode_to(to = "Male Child-headed",
            where = breadwinner == "male_14_17" & household_expenditure.male_14_17 == 1) %>%
  recode_to(to = "Female Child-headed",
            where = breadwinner == "female_14_17" & household_expenditure.female_14_17 == 1) %>%
  # Vulnerable members in household
  # Documentation
  # Dependency level
  ## WDR
  new_recoding(target = WDR) %>%
  recode_directly(to_expression = total_hh / working_persons) %>%
  new_recoding(target = WDR_score) %>%
  recode_to(to = 1, where = WDR <= .20) %>%
  recode_to(to = 2, where = WDR > .21 & WDR <= .30) %>%
  recode_to(to = 3, where = WDR >.31 & WDR <= .40) %>%
  recode_to(to = 4, where = WDR >.41 & WDR <= .60) %>%
  recode_to(to = 5, where = WDR >.61 & WDR <= .70) %>%
  recode_to(to = 6, where = WDR >.71 & WDR <= .80) %>%
  recode_to(to = 7, where = WDR >.81 & WDR <= .90) %>%
  recode_to(to = 8, where = WDR >.90) %>%
  ## ADR
  ## CGT
  new_recoding(target = CGT_score, source = care_giving_time) %>%
  recode_to(to = 1, where.selected.exactly = "less_1h") %>%
  recode_to(to = 2, where.selected.exactly = "1h_2h") %>%
  recode_to(to = 4, where.selected.exactly = "2h_3h") %>%
  recode_to(to = 6, where.selected.exactly = "3h_4h") %>%
  recode_to(to = 8, where.selected.exactly = "4hmore") %>%
  # Poverty levels
  ## poverty_level_income
  new_recoding(target = income_score, source = average_income) %>%
  recode_to(to = 2, where.selected.exactly = "200more") %>%
  recode_to(to = 4, where.selected.exactly = "151_200") %>%
  recode_to(to = 5, where.selected.exactly = "101_150") %>%
  recode_to(to = 6, where.selected.exactly = "61_100") %>%
  recode_to(to = 7, where.selected.exactly = "31_60") %>%
  recode_to(to = 8, where.selected.exactly = "less30") %>%
  recode_to(to = 9, where.selected.exactly = "none") %>%
  ## debt income ratio
  ### income_middle_point
  new_recoding(target = income_middle, source = average_income) %>%
  recode_to(to = 200, where.selected.exactly = "200more") %>%
  recode_to(to = 175, where.selected.exactly = "151_200") %>%
  recode_to(to = 125, where.selected.exactly = "101_150") %>%
  recode_to(to = 80, where.selected.exactly = "61_100") %>%
  recode_to(to = 45, where.selected.exactly = "31_60") %>%
  recode_to(to = 15, where.selected.exactly = "less30") %>%
  recode_to(to = 10, where.selected.exactly = "none") %>%
  ### debt_middle_point
  new_recoding(target = debt_middle, source = average_debt) %>%
  recode_to(to = 200, where.selected.exactly = "200more") %>%
  recode_to(to = 175, where.selected.exactly = "151_200") %>%
  recode_to(to = 125, where.selected.exactly = "101_150") %>%
  recode_to(to = 80, where.selected.exactly = "61_100") %>%
  recode_to(to = 45, where.selected.exactly = "31_60") %>%
  recode_to(to = 15, where.selected.exactly = "less30") %>%
  recode_to(to = 10, where.selected.exactly = "none") %>%
  ### dir
  new_recoding(target = DIR) %>%
  recode_directly(to_expression = debt_middle / income_middle) %>%
  new_recoding(target = DIR_score) %>%
  recode_to(to = 1, where = DIR <= .25) %>%
  recode_to(to = 2, where = DIR > .25 & DIR <= .50) %>%
  recode_to(to = 3, where = DIR >.50 & DIR <= .60) %>%
  recode_to(to = 4, where = DIR >.61 & DIR <= .75) %>%
  recode_to(to = 5, where = DIR >.75 & DIR <= .85) %>%
  recode_to(to = 6, where = DIR >.85 & DIR <= 1) %>%
  recode_to(to = 7, where = DIR >1 & DIR <= 2) %>%
  recode_to(to = 8, where = DIR >2) %>%
  #Expenditure on basic goods and services
  ## total expenditure
  ### education
  new_recoding(target = spent_education_middle, source = cash_bracket_education) %>%
  recode_to(to = 5, where.selected.exactly = "usd_0_9") %>%
  recode_to(to = 30, where.selected.exactly = "usd_10_50") %>%
  recode_to(to = 75, where.selected.exactly = "usd_50_100") %>%
  recode_to(to = 100, where.selected.exactly = "usd_more_100") %>%
  # recode_to(to = "dd", where.selected.exactly = "dnk") %>%
  ### health
  new_recoding(target = spent_health_middle, source = cash_bracket_treatment) %>%
  recode_to(to = 5, where.selected.exactly = "usd_0_9") %>%
  recode_to(to = 30, where.selected.exactly = "usd_10_50") %>%
  recode_to(to = 75, where.selected.exactly = "usd_50_100") %>%
  recode_to(to = 100, where.selected.exactly = "usd_more_100") %>%
  # recode_to(to = "dd", where.selected.exactly = "dnk") %>%
  ### water
  new_recoding(target = spent_water_middle, source = how_much_pay_water) %>%
  recode_to(to = 30, where.selected.exactly = "less_than_10") %>%
  recode_to(to = 45, where.selected.exactly = "11_20_month") %>%
  recode_to(to = 75, where.selected.exactly = "21_30_month") %>%
  recode_to(to = 105, where.selected.exactly = "31_40_month") %>%
  recode_to(to = 135, where.selected.exactly = "41_50_month") %>%
  recode_to(to = 150, where.selected.exactly = "50_more_month") %>%
  # recode_to(to = "dd", where.selected.exactly = "dnk") %>%
  ### food
  new_recoding(target = spent_food_middle, source = spent_food) %>%
  recode_to(to = 30, where.selected.exactly = "less10") %>%
  recode_to(to = 45, where.selected.exactly = "11_20") %>%
  recode_to(to = 75, where.selected.exactly = "21_30") %>%
  recode_to(to = 105, where.selected.exactly = "31_40") %>%
  recode_to(to = 135, where.selected.exactly = "41_50") %>%
  recode_to(to = 165, where.selected.exactly = "51_60") %>%
  recode_to(to = 195, where.selected.exactly = "61_70") %>%
  recode_to(to = 225, where.selected.exactly = "71_80") %>%
  recode_to(to = 255, where.selected.exactly = "81_90") %>%
  recode_to(to = 285, where.selected.exactly = "91_100") %>%
  recode_to(to = 300, where.selected.exactly = "100more") %>%
  # recode_to(to = "dd", where.selected.exactly = "dnk") %>%
  ## total_expenditure_middle
  new_recoding(target = total_expenditure_middle) %>%
  recode_directly(to_expression = sum(spent_education_middle, spent_health_middle, spent_water_middle,
                    spent_food_middle, na.rm = T)) %>%
  ## HHEX
  new_recoding(target = HHEX) %>%
  recode_directly(to_expression = total_expenditure_middle / income_middle) %>%
  ## HHEW_score
  new_recoding(target = HHEX_score) %>%
  recode_to(to = 1, where = HHEX <= .25) %>%
  recode_to(to = 2, where = HHEX > .25 & HHEX <= .50) %>%
  recode_to(to = 3, where = HHEX > .50 & HHEX <= .75) %>%
  recode_to(to = 4, where = HHEX > .75 & HHEX <= .80) %>%
  recode_to(to = 5, where = HHEX > .80 & HHEX <= .90) %>%
  recode_to(to = 6, where = HHEX > .90 & HHEX <= 1) %>%
  recode_to(to = 7, where = HHEX > 1 & HHEX <= 2) %>%
  recode_to(to = 8, where = HHEX > 2) %>%
  # displacement
  # access to market
  new_recoding(target = access_to_market_score) %>%
  recode_to(to = 1, where.selected.exactly = "less15", source = time_market) %>%
  recode_to(to = 2, where.selected.exactly = "16_30", source = time_market) %>%
  recode_to(to = 3, where.selected.exactly = "31_60", source = time_market) %>%
  recode_to(to = 4, where.selected.exactly = "60_180", source = time_market) %>%
  recode_to(to = 4, where = time_market == "31_60" & transport_market == "walking") %>%
  recode_to(to = 5, where.selected.exactly = "above180", source = time_market) %>%
  recode_to(to = 6, where = time_market == "above180" & 
              transport_market %in% c("walking", "bicycle", "cart")) %>%
  end_recoding()


?recode_to

